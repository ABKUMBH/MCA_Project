pipeline {
    options {
            buildDiscarder(logRotator(numToKeepStr: '5', artifactNumToKeepStr: '5'))
    }
    agent any
    tools {
        maven 'maven_3.8.8'
    }
    stages{
        stage('code compile'){
            steps{
            echo 'code started compiling'
            sh 'mvn clean compile'
            echo 'code compiled successfully'
            }
        }


        stage('code package'){
            steps{
            echo 'code started packaging'
            sh 'mvn clean package -DskipTests'
            echo 'code packaged successfully'
            }
        }

        stage('Building and tag docker image'){
             steps{
             echo 'starting building docker image'
             sh 'docker build -t abkumbh/cafe:latest .'
             echo 'completed building docker image'
             }
        }

        stage('Docker push to Docker Hub') {
              steps {
              withCredentials([string(credentialsId: 'dockerhubcred', variable: 'dockerhubcred')]) {
              sh 'docker login docker.io -u abkumbh -p ${dockerhubcred}'
              echo "Pushing Docker Image to DockerHub: In Progress"
              sh 'docker push abkumbh/cafe:latest'
              echo "Pushing Docker Image to DockerHub: Completed"
              sh 'whoami'
              }
              }
        }
    }
}